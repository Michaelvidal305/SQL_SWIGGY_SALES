--KPI'S
--Total Orders
SELECT COUNT(*) AS total_orders
FROM fact_swiggy_orders

--Total Revenu
SELECT 
    TO_CHAR(SUM(price::numeric) / 1000000, 'FM999999990.00') 
    || ' INR Million' AS total_revenue_million
FROM fact_swiggy_orders;


--Average Dish Price
SELECT 
    TO_CHAR(AVG(price::numeric), 'FM999999990.00')
    || ' INR' AS avg_price_inr
FROM fact_swiggy_orders;


--Average Rating
SELECT AVG(rating) AS avg_rating
FROM fact_swiggy_orders;

--GRANULAR REQUIREMENTS

--Monthly Orders (YYYY-MM)
SELECT
	d.year,
	d.month,
	d.month_name,
	COUNT(*) AS total_orders
FROM fact_swiggy_orders f
JOIN dim_date d ON f.date_id = d.date_id
GROUP BY d.year, d.month, d.month_name
ORDER BY d.year, d.month;

--Quarterly Orders (Q1, Q2, Q3, Q4)
SELECT 
	d.year,
	d.quarter, 
	COUNT(*) AS total_orders
FROM fact_swiggy_orders f
JOIN dim_date d ON f.date_id = d.date_id
GROUP BY d.year, d.quarter
ORDER BY d.year, d.quarter;

--Yearly Orders
SELECT 
	d.year,
	COUNT(*) AS total_orders
FROM fact_swiggy_orders f
JOIN dim_date d ON f.date_id = d.date_id
GROUP BY d.year
ORDER BY d.year

--Order by Day of Week (Mon-Sun)
SELECT 
    TO_CHAR(d.full_date, 'Day') AS day_name,
    COUNT(*) AS total_orders
FROM fact_swiggy_orders f
JOIN dim_date d 
    ON f.date_id = d.date_id
GROUP BY 
    TO_CHAR(d.full_date, 'Day'),
    EXTRACT(DOW FROM d.full_date)
ORDER BY 
    EXTRACT(DOW FROM d.full_date);

--Top 10 Cities by Orders
SELECT
    l.city,
    COUNT(*) AS total_orders
FROM fact_swiggy_orders f
JOIN dim_location l 
    ON f.location_id = l.location_id
GROUP BY 
    l.city
ORDER BY 
    total_orders DESC
LIMIT 10 OFFSET 0;


--Top 10 Restaurants by Orders  
SELECT 
    r.restaurant_name,
    COUNT(*) AS total_orders
FROM fact_swiggy_orders f
JOIN dim_restaurant r 
    ON f.restaurant_id = r.restaurant_id
GROUP BY 
    r.restaurant_name
ORDER BY 
    total_orders DESC
LIMIT 10 OFFSET 0;

--Top Categories by Order Volume
SELECT
	c.category
	COUNT(*) AS total_orders
FROM fact_swiggy_orders f
JOIN dim_category c ON f.category_id = c.category_id
GROUP BY c.category
ORDER BY total_orders DESC;

--Most Ordered Dishes
